#lang racket
(require "base")

(provide escolher-linha
         escolher-coluna
         escolher-colunas
         gerar-populacao-inicial
         )

(random-seed 13)

;;escolhe uma coluna randomica que cubra a linha informada
(define (escolher-coluna colunas linha)
  
  (define (contem-linha? coluna)
    (ormap (λ (l) (equal? l linha)) 
            (coluna-linhas-cobertas coluna)))
  
  (define colunas-que-cobrem-linha 
    (filter contem-linha? colunas))
  
  (list-ref  colunas-que-cobrem-linha
             (random (length colunas-que-cobrem-linha))))

;;escolhe uma linha randomica
(define (escolher-linha linhas)
  (list-ref linhas (random (length linhas))))

;;chama gerar-individuo para uma lista de linhas-livres atualizada
(define (cons-escolher-colunas coluna-escolhida colunas linhas-livres)
  (cons coluna-escolhida 
        (escolher-colunas colunas 
                         (remove* (coluna-linhas-cobertas coluna-escolhida)
                                  linhas-livres))))

;;agrupa as colunas que formam um individuo
(define (escolher-colunas colunas linhas-livres)  
  (cond [(empty? linhas-livres) empty]
        [else (cons-escolher-colunas (escolher-coluna colunas (escolher-linha linhas-livres))
                                    colunas
                                    linhas-livres)]))

;;gera a populacao inicial
(define (gerar-populacao-inicial p)
  (struct-copy problema p 
               [populacao (build-list (problema-populacao-maxima p)
                          (λ (n) (make-individuo (escolher-colunas (problema-colunas p)
                                                                   (problema-linhas-livres p)))))]))



(define (escolher-reprodutores problema) problema)

(define (cruzar-reprodutores problema) problema)

(define (avaliar-filhos problema) problema)

(define (gerar-mutacao problema) problema)

(define (atualizar-populacao problema) problema)